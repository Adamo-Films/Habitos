<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Danilo no Arcade</title>
  <!-- FONTES -->
  <link href="https://fonts.googleapis.com/css?family=Bebas+Neue:400&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Bungee&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Antonio:wght@100&family=Inter:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&display=swap" rel="stylesheet">
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      min-height: 100vh;
    }
    body {
      width: 100vw;
      height: 100vh;
      background: url('Artboard 1@3x.png') no-repeat center center fixed;
      background-size: contain;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .arcade-screen {
      position: absolute;
      top: 70px;
      left: 50%;
      transform: translateX(-50%);
      width: 300px;
      height: 230px;
      background: #1c7be3cc;
      border-radius: 32px;
      box-shadow: 0 0 38px 14px #00caff55 inset, 0 0 18px 0 #0ff5 inset;
      overflow-y: auto;
      overflow-x: hidden;
      border: 5px solid #19e0fc99;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
    }
    .arcade-screen::-webkit-scrollbar {
      width: 6px;
      background: #142c40;
      border-radius: 12px;
    }
    .arcade-screen::-webkit-scrollbar-thumb {
      background: #19e0fc55;
      border-radius: 12px;
    }
    #calendario {
      width: 96%;
      max-width: 95%;
      font-size: 0.89em;
      color: #fff;
      margin: 0 auto;
    }
    table {
      background: none;
      color: #fff;
      font-size: 0.94em;
      border-collapse: collapse;
    }
    th, td {
      color: #fff !important;
      padding: 6px 5px;
      background: none !important;
      border-bottom: 1px solid #fff2;
      text-shadow: 0 1px 2px #0e223977;
    }
    tr.main-row {
      background: rgba(10,30,70,0.19) !important;
      color: #fff !important;
    }
    .mes {
      margin: 6px 0 1px;
      padding: 0;
      font-size: 1em;
      color: #ffe379;
      letter-spacing: 0.11em;
      font-family: 'Bungee', Arial, sans-serif;
      text-shadow: 0 2px 6px #000a;
    }
    .habit-label { color: #fff !important; }
    @media (max-width: 480px) {
      .arcade-screen {
        top: 30px;
        width: 98vw;
        height: 210px;
        min-width: 0;
        border-radius: 18px;
        font-size: 0.75em;
      }
      #calendario { font-size: 0.79em; }
    }
    @media (min-width: 481px) and (max-width: 700px) {
      .arcade-screen {
        width: 98vw;
        height: 230px;
        border-radius: 22px;
      }
    }
    /* Remove tudo que n√£o √© a tela arcade */
    .top-supergrid, .banner-gamer, .top-counters-col, .center-banner-col, .sticky-counter, #confetti-canvas, #reward-confetti, #celebrate-text, audio, .reward-card {
      display: none !important;
    }
  </style>
</head>
<body>
  <!-- Apenas a tela da arcade centralizada -->
  <div class="arcade-screen">
    <div id="calendario"></div>
  </div>
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <script>
    // Firebase config (igual ao original)
    const firebaseConfig = {
      apiKey: "AIzaSyAMnk4nDBd6nbvt9ElZeKDlJA7cp2vYfIk",
      authDomain: "habitos-danilo.firebaseapp.com",
      projectId: "habitos-danilo",
      storageBucket: "habitos-danilo.appspot.com",
      messagingSenderId: "342699648229",
      appId: "1:342699648229:web:a22b4706e2dde3c1c1200c",
      measurementId: "G-5589029JGV"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    // Fun√ß√£o para buscar progresso do Firebase ou LocalStorage
    async function getProgress() {
      try {
        const doc = await db.collection("usuarios").doc("danilo").get();
        return doc.exists ? doc.data() : {};
      } catch (e) {
        console.error("Erro ao buscar dados do Firebase:", e);
        return JSON.parse(localStorage.getItem('habits-progress-v1')) || {};
      }
    }
    // Fun√ß√£o para salvar progresso no Firebase e LocalStorage
    async function saveProgress(progress) {
      try {
        await db.collection("usuarios").doc("danilo").set(progress);
      } catch (e) {
        console.error("Erro ao salvar no Firebase:", e);
      }
      localStorage.setItem('habits-progress-v1', JSON.stringify(progress));
    }
    // Configura√ß√£o dos meses, h√°bitos, ciclos, emojis
    const habitEmojis = [
      "üíß", "ü§≥", "‚öñÔ∏è", "ü•ó", "‚è∞", "üßò", "üèãÔ∏è", "üìö", "üç´üö´", "üáÆüáπ",
    ];
    const cycleEmojis = ["üí¨", "üöø", "üß†", "üôè"];
    const monthNames = [
      "Janeiro", "Fevereiro", "Mar√ßo", "Abril",
      "Maio", "Junho", "Julho", "Agosto",
      "Setembro", "Outubro", "Novembro", "Dezembro"
    ];
    document.addEventListener("DOMContentLoaded", async function() {
      const progress = await getProgress();
      const dados = [];
      const habitos_incrementais = {
        1: ["Beber 2L de √°gua", "Tirar selfie", "Verificar peso"],
        5: ["Dieta com alimentos integrais"],
        9: ["Acordar √†s 5h"],
        13: ["Medita√ß√£o (10 min por dia)"],
        17: ["Exerc√≠cio (60 min)"],
        21: ["Leitura (30 min)"],
        25: ["Alimenta√ß√£o sem a√ß√∫car refinado"],
        29: ["Pr√°tica de italiano (20 min por dia)"]
      };
      const habitos_ciclicos = ["Afirma√ß√µes", "Banho gelado", "Exerc√≠cio de agilidade mental", "Di√°rio e gratid√£o"];
      const inicio = new Date(2025, 4, 21), fim = new Date(2025, 7, 21);
      const dias_total = Math.floor((fim - inicio) / (1000 * 60 * 60 * 24)) + 1;
      let habitos_ativos = [];
      for (let i = 1; i <= dias_total; i++) {
        const data_atual = new Date(inicio);
        data_atual.setDate(inicio.getDate() + i - 1);
        if (habitos_incrementais[i]) {
          habitos_ativos = habitos_ativos.concat(habitos_incrementais[i]);
        }
        const habito_ciclico = habitos_ciclicos[(i - 1) % 4];
        dados.push({
          data: data_atual.toLocaleDateString('pt-BR'),
          dia: `Dia ${i}`,
          habitos: [...habitos_ativos],
          ciclico: habito_ciclico,
          mes: data_atual.getMonth() + 1,
          ano: data_atual.getFullYear(),
          diaDoMes: data_atual.getDate(),
          id: `dia-${data_atual.getFullYear()}-${data_atual.getMonth()+1}-${data_atual.getDate()}`
        });
      }
      const calendario = document.getElementById("calendario");
      const grupos = {};
      dados.forEach((obj) => {
        const id = `${obj.mes}-${obj.ano}`;
        if (!grupos[id]) grupos[id] = [];
        grupos[id].push(obj);
      });
      let html = '';
      Object.entries(grupos).forEach(([id, dias]) => {
        const [mes, ano] = id.split("-");
        const mesNum = Number(mes);
        const anoNum = Number(ano);
        const nomeMes = monthNames[mesNum - 1].toUpperCase();
        html += `<div class='mes'>${nomeMes} ${ano}</div>
        <table>
          <thead>
            <tr>
              <th></th>
              <th>Data</th>
              <th>Dia</th>
              <th>H√°bitos Di√°rios</th>
              <th>H√°bito C√≠clico</th>
            </tr>
          </thead>
          <tbody>`;
        dias.forEach((dia) => {
          const dayNum = parseInt(dia.dia.substring(4));
          let habitosCellText;
          if (dayNum <= 4) {
            habitosCellText = dia.habitos.join(', ');
          } else if (habitos_incrementais[dayNum]) {
            const newHabs = habitos_incrementais[dayNum];
            const totalBefore = dia.habitos.length - newHabs.length;
            habitosCellText = `${totalBefore} ${totalBefore > 1 ? 'h√°bitos' : 'h√°bito'} + ${newHabs.join(', ')}`;
          } else {
            const total = dia.habitos.length;
            habitosCellText = `${total} ${total > 1 ? 'h√°bitos' : 'h√°bito'}`;
          }
          html += `
          <tr class="main-row" data-dropdown="${dia.id}" id="mainrow-${dia.id}" style="--progress:0">
            <td><span class="expand-icon">&#9654;</span></td>
            <td class="progress-text gold">${dia.data}</td>
            <td class="progress-text gold">${dia.dia}</td>
            <td class="progress-text gold">${habitosCellText}</td>
            <td class="progress-text gold">${dia.ciclico}</td>
          </tr>
          <tr class="dropdown" id="dropdown-${dia.id}">
            <td colspan="5">
              <div class="habit-list">
                ${dia.habitos.map((h, idx) => `
                  <div class="habit-item" id="habititem-${dia.id}-habit-${idx}">
                    <span class="habit-emoji" data-checkbox="${dia.id}-habit-${idx}">${habitEmojis[idx % habitEmojis.length]}</span>
                    <label class="habit-label" for="${dia.id}-habit-${idx}" id="label-${dia.id}-habit-${idx}">${h}</label>
                    <input type="checkbox" class="habit-checkbox" id="${dia.id}-habit-${idx}">
                  </div>
                `).join('')}
                <div class="habit-item" id="habititem-${dia.id}-ciclico">
                  <span class="habit-emoji" data-checkbox="${dia.id}-ciclico">${cycleEmojis[(dia.mes + dia.ano) % cycleEmojis.length]}</span>
                  <label class="habit-label" for="${dia.id}-ciclico" id="label-${dia.id}-ciclico">${dia.ciclico}</label>
                  <input type="checkbox" class="habit-checkbox" id="${dia.id}-ciclico">
                </div>
              </div>
            </td>
          </tr>`;
        });
        html += `</tbody></table>`;
      });
      calendario.innerHTML = html;
      // Marcar o progresso salvo nos checkboxes
      Object.keys(progress).forEach(checkId => {
        const checkbox = document.getElementById(checkId);
        if (checkbox) {
          checkbox.checked = progress[checkId];
          const label = document.getElementById('label-' + checkId);
          if (label) label.classList.toggle('habit-done', progress[checkId]);
          const hi = document.getElementById('habititem-' + checkId);
          if (hi) hi.classList.toggle('habit-complete', progress[checkId]);
        }
      });

      // Atualiza barra de progresso dourada por dia
      function updateProgressBar(dayId, habitCount) {
        let checked = 0;
        for (let i = 0; i < habitCount; i++) {
          if (document.getElementById(`${dayId}-habit-${i}`)?.checked) checked++;
        }
        if (document.getElementById(`${dayId}-ciclico`)?.checked) checked++;
        let pct = checked / habitCount;
        const row = document.getElementById(`mainrow-${dayId}`);
        if (row) {
          row.style.transition = 'background-size 0.7s cubic-bezier(.6,1.2,.16,1.08), color 0.3s';
          row.style.setProperty('--progress', pct);
          if (pct === 1) row.classList.add('day-complete');
          else row.classList.remove('day-complete');
        }
      }

      // Dropdown toggle
      document.querySelectorAll('tr.main-row').forEach(row => {
        row.addEventListener('click', function(e) {
          if (e.target.tagName === 'INPUT' || e.target.tagName === 'LABEL' || e.target.classList.contains('habit-emoji')) return;
          const dropdownId = this.getAttribute('data-dropdown');
          const dropdown = document.getElementById(`dropdown-${dropdownId}`);
          if (dropdown.classList.contains('active')) {
            dropdown.classList.remove('active');
            dropdown.classList.add('drop-up');
            setTimeout(() => dropdown.classList.remove('drop-up'), 400);
            this.classList.remove('expanded');
          } else {
            document.querySelectorAll('.dropdown.active').forEach(dd => {
              dd.classList.remove('active');
              dd.classList.add('drop-up');
              setTimeout(() => dd.classList.remove('drop-up'), 400);
              document.querySelector(`.main-row[data-dropdown="${dd.id.replace('dropdown-','')}"]`).classList.remove('expanded');
            });
            dropdown.classList.add('active');
            dropdown.classList.remove('drop-up');
            this.classList.add('expanded');
          }
        });
      });

      function checkAllHabitsComplete(dayId, habitCount) {
        let complete = true;
        for (let i = 0; i < habitCount; i++) {
          if (!document.getElementById(`${dayId}-habit-${i}`)?.checked) {
            complete = false;
            break;
          }
        }
        if (complete && !document.getElementById(`${dayId}-ciclico`)?.checked) complete = false;
        return complete;
      }

      document.querySelectorAll('.habit-checkbox').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
          const label = document.getElementById('label-' + this.id);
          if (label) label.classList.toggle('habit-done', this.checked);

          getProgress().then(progress => {
            progress[this.id] = this.checked;
            saveProgress(progress);
          });

          const hi = document.getElementById('habititem-' + this.id);
          if (hi) hi.classList.toggle('habit-complete', this.checked);

          const parts = this.id.match(/^dia-\d+-\d+-\d+/);
          if (parts) {
            const dayId = parts[0];
            const habitCount = document.querySelectorAll(`#dropdown-${dayId} .habit-checkbox`).length;
            updateProgressBar(dayId, habitCount);
            const allDone = checkAllHabitsComplete(dayId, habitCount - 1);
            const dropdown = document.getElementById(`dropdown-${dayId}`);
            const dayRow = document.getElementById(`mainrow-${dayId}`);
            if (allDone) {
              dayRow.classList.add('day-complete');
              setTimeout(() => {
                if (dropdown) {
                  dropdown.classList.remove('active');
                  dropdown.classList.add('drop-up');
                  setTimeout(() => dropdown.classList.remove('drop-up'), 400);
                }
                if (dayRow) dayRow.classList.remove('expanded');
              }, 950);
            } else {
              dayRow.classList.remove('day-complete');
            }
          }
        });
      });

      document.querySelectorAll('.habit-emoji').forEach(emoji => {
        emoji.addEventListener('mouseenter', function() {
          emoji.classList.add('glow');
          setTimeout(() => emoji.classList.remove('glow'), 680);
        });
        emoji.addEventListener('mouseleave', function() {
          emoji.classList.remove('glow');
        });
        emoji.addEventListener('click', function(e) {
          e.stopPropagation();
          const id = emoji.getAttribute('data-checkbox');
          const checkbox = document.getElementById(id);
          if (checkbox) {
            checkbox.checked = !checkbox.checked;
            checkbox.dispatchEvent(new Event('change'));
          }
        });
      });

      // Progress bar para todos os dias!
      dados.forEach((dia) => {
        const habitCount = dia.habitos.length + 1;
        updateProgressBar(dia.id, habitCount);
        const allDone = checkAllHabitsComplete(dia.id, habitCount - 1);
        if (allDone) {
          const dayRow = document.getElementById(`mainrow-${dia.id}`);
          if (dayRow) dayRow.classList.add('day-complete');
        }
      });

    }); // Fim do DOMContentLoaded
  </script>
</body>
</html>
