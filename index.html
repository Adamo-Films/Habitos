<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Danilo no Controle</title>
  <!-- Fonte ultra fina, tall e bem clara -->
  <link href="https://fonts.googleapis.com/css2?family=Antonio:wght@100;400;700&family=Montserrat:wght@100;200;300;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --azul-shadow: #191246;
      --header-azul: #18104b;
      --laranja-3d: #ff522e;
      --branco: #fff;
    }
    body {
      font-family: 'Montserrat', 'Antonio', 'Arial Narrow', Arial, sans-serif;
      background-color: #121212;
      color: #e0e0e0;
      margin: 0;
      padding: 0;
    }
    .header-3d-bg {
      width: 100vw;
      background: var(--header-azul);
      margin-bottom: 36px;
      padding-top: 36px;
      padding-bottom: 46px;
      box-shadow: 0 14px 70px 0 #000b  ;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      min-height: 150px;
      overflow-x: hidden;
    }
    .titulo-3d {
      font-family: 'Antonio', 'Montserrat', 'League Gothic', 'Arial Narrow', Arial, sans-serif;
      font-size: 7vw;
      font-weight: 100;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--branco);
      line-height: 1.03;
      text-align: center;
      /* Letras super finas! */
      font-stretch: expanded;
      /* Long orange 3d shadow */
      text-shadow:
        0.08em 0.12em 0 var(--laranja-3d),
        0.15em 0.23em 0 var(--laranja-3d),
        0.22em 0.34em 0 var(--laranja-3d),
        0.33em 0.47em 0 var(--laranja-3d),
        0.42em 0.62em 0 var(--laranja-3d),
        0.65em 0.93em 0 var(--laranja-3d),
        1em 1.7em 18px var(--azul-shadow),
        2em 3.2em 44px var(--azul-shadow),
        0 8px 70px #0008;
      z-index: 2;
      padding: 0 20px;
    }
    @media (max-width: 800px) {
      .titulo-3d { font-size: 12vw; }
      .header-3d-bg { padding-top: 20px; padding-bottom: 28px;}
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 40px;
    }
    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #333;
    }
    th {
      background-color: #1e1e1e;
      color: #f9c74f;
    }
    tr.main-row {
      cursor: pointer;
      transition: background 0.2s;
    }
    tr.main-row:hover {
      background-color: #1f2d3d;
    }
    .mes {
      font-size: 1.4em;
      margin: 40px 0 10px;
      border-bottom: 2px solid #f9c74f;
      padding-bottom: 5px;
    }
    .dropdown {
      background: #181818;
      border-bottom: 1px solid #333;
      display: none;
      animation: fadeIn 0.3s;
    }
    @keyframes fadeIn {
      from { opacity: 0;}
      to { opacity: 1;}
    }
    .habit-list {
      margin: 10px 0 10px 32px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .habit-item {
      display: flex;
      align-items: center;
      gap: 16px;
      font-size: 1.18em;
    }
    .habit-checkbox {
      transform: scale(1.17);
      cursor: pointer;
    }
    .habit-done {
      text-decoration: line-through;
      color: #888;
    }
    /* Emoji animado */
    .habit-emoji {
      font-size: 1.4em;
      display: inline-block;
      transition: transform 0.17s cubic-bezier(.65,-0.6,.31,1.7);
      filter: drop-shadow(0 2px 6px #0007);
      cursor: pointer;
      will-change: transform;
      user-select: none;
    }
    .habit-emoji:hover {
      animation: emoji-bounce 0.7s cubic-bezier(.24,-0.06,.41,1.37) 1;
      filter: drop-shadow(0 0 10px #f0a) drop-shadow(0 0 6px #fff9);
      transform: rotate(-18deg) scale(1.18);
    }
    @keyframes emoji-bounce {
      0%   { transform: scale(1)    rotate(0);}
      30%  { transform: scale(1.23) rotate(-22deg);}
      60%  { transform: scale(0.94) rotate(17deg);}
      90%  { transform: scale(1.12) rotate(-9deg);}
      100% { transform: scale(1.18) rotate(-18deg);}
    }
    .expand-icon {
      display: inline-block;
      width: 16px;
      transition: transform 0.2s;
    }
    .expanded > .expand-icon {
      transform: rotate(90deg);
    }
    /* Verde met√°lico sofisticado */
    .day-complete {
      background: linear-gradient(90deg, #304d39 0%, #b6ffe5 60%, #b2c7ae 100%) !important;
      color: #203726 !important;
      font-weight: bold;
      box-shadow: 0 0 22px 2px #aef5ce60, 0 0 0 3px #31604f70 inset;
      letter-spacing: 1px;
      text-shadow: 0 2px 2px #e3fff5cc, 0 0 12px #89ffa099, 0 0 1px #fff;
      border-left: 7px solid #2ff0d1;
      border-right: 2px solid #b5e9ca;
    }
    /* Confetti canvas */
    #confetti-canvas {
      position: fixed;
      left: 0; top: 0; width: 100vw; height: 100vh;
      pointer-events: none;
      z-index: 9999;
      display: none;
    }
    /* Texto de celebra√ß√£o (sem barras) */
    #celebrate-text {
      display: none;
      position: fixed;
      left: 50%; top: 38%;
      transform: translate(-50%, -50%);
      font-size: 5vw;
      color: #15ffb6;
      text-shadow:
        0 0 8px #fff,
        0 0 36px #44ffa6,
        0 0 110px #001130,
        5px 5px 0 #0a355b;
      font-weight: bold;
      z-index: 10000;
      font-family: 'Antonio', 'Montserrat', 'League Gothic', 'Arial Narrow', Arial, sans-serif;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      animation: celebrateText 2.5s ease-out;
      background: none !important;
      border: none !important;
      border-radius: 0 !important;
      padding: 0 18px 0 18px;
    }
    @keyframes celebrateText {
      0%   { transform: translate(-50%, -50%) scale(0.7); opacity: 0; }
      50%  { transform: translate(-50%, -56%) scale(1.12); opacity: 1;}
      100% { transform: translate(-50%, -50%) scale(1); opacity: 1;}
    }
  </style>
</head>
<body>
  <div class="header-3d-bg">
    <div class="titulo-3d">Danilo no Controle</div>
  </div>
  <div id="calendario"></div>
  <!-- Canvas para confetes -->
  <canvas id="confetti-canvas"></canvas>
  <!-- Texto de celebra√ß√£o -->
  <div id="celebrate-text">VAI MLK!!!</div>
  <!-- Som de conquista confi√°vel -->
  <audio id="celebrate-audio">
    <source src="https://cdn.jsdelivr.net/gh/napthedev/short-audio/success.mp3" type="audio/mpeg">
    <source src="https://cdn.jsdelivr.net/gh/napthedev/short-audio/success.ogg" type="audio/ogg">
  </audio>
<script>
  // ---- EMOJIS para cada h√°bito (ajuste se quiser outros)
  const habitEmojis = [
    "üíß", // Beber 2L de √°gua
    "ü§≥", // Tirar selfie
    "‚öñÔ∏è", // Verificar peso
    "ü•ó", // Dieta com alimentos integrais
    "‚è∞", // Acordar √†s 5h
    "üßò", // Medita√ß√£o
    "üèãÔ∏è", // Exerc√≠cio
    "üìö", // Leitura
    "üç´üö´", // Sem a√ß√∫car refinado
    "üáÆüáπ", // Italiano
  ];
  // Ciclicos
  const cycleEmojis = [
    "üí¨", // Afirma√ß√µes
    "üöø", // Banho gelado
    "üß†", // Agilidade mental
    "üôè", // Di√°rio e gratid√£o
  ];
  // ---------------------- CONFETTI ANIMATION (Canvas) ----------------------
  function launchConfettiEpic() {
    const canvas = document.getElementById('confetti-canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    canvas.style.display = 'block';

    let W = canvas.width;
    let H = canvas.height;
    let particles = [];
    let colors = ['#FF522E','#fafff9','#FFD700','#FF69B4','#00E6F6','#82FF6A','#FF6666','#0ed156','#001130','#30ff96','#b5e9ca','#fd2a49'];
    for (let i = 0; i < 1200; i++) {
      particles.push({
        x: Math.random() * W,
        y: Math.random() * -H,
        r: 7 + Math.random() * 12,
        d: Math.random() * 180,
        color: colors[Math.floor(Math.random()*colors.length)],
        tilt: Math.random() * 16 - 8,
        tiltAngle: 0,
        tiltAngleIncremental: (Math.random() * 0.09) + .05,
        alpha: 0.84 + Math.random() * 0.16
      });
    }

    let angle = 0;
    function draw() {
      ctx.clearRect(0, 0, W, H);
      for (let i = 0; i < particles.length; i++) {
        ctx.beginPath();
        ctx.lineWidth = particles[i].r / 2;
        ctx.strokeStyle = particles[i].color;
        ctx.globalAlpha = particles[i].alpha;
        ctx.moveTo(particles[i].x + particles[i].tilt + particles[i].r / 4, particles[i].y);
        ctx.lineTo(particles[i].x + particles[i].tilt, particles[i].y + particles[i].r);
        ctx.stroke();
      }
      ctx.globalAlpha = 1;
      update();
    }
    function update() {
      angle += 0.008;
      for (let i = 0; i < particles.length; i++) {
        particles[i].y += (Math.cos(angle + particles[i].d) + 2.8 + particles[i].r/6) * 0.93;
        particles[i].x += Math.sin(angle*1.18 + i) * 2.7;
        particles[i].tiltAngle += particles[i].tiltAngleIncremental;
        particles[i].tilt = Math.sin(particles[i].tiltAngle - (i % 3)) * 18;
        if (particles[i].y > H + 30) {
          particles[i].y = -14;
          particles[i].x = Math.random() * W;
        }
      }
    }

    let interval = setInterval(draw, 13);

    // Mostra/Some texto "VAI MLK!!!"
    const celebrateText = document.getElementById('celebrate-text');
    celebrateText.style.display = 'block';

    setTimeout(() => {
      clearInterval(interval);
      ctx.clearRect(0, 0, W, H);
      canvas.style.display = 'none';
      celebrateText.style.display = 'none';
    }, 4000); // agora dura 4 segundos!
  }

  // -------------------- PROGRESSO LOCALSTORAGE ----------------------
  function getProgress() {
    const progress = localStorage.getItem('habits-progress-v1');
    return progress ? JSON.parse(progress) : {};
  }
  function saveProgress(progress) {
    localStorage.setItem('habits-progress-v1', JSON.stringify(progress));
  }

  document.addEventListener("DOMContentLoaded", function() {
    const dados = [];
    const habitos_incrementais = {
      1: ["Beber 2L de √°gua", "Tirar selfie", "Verificar peso"],
      5: ["Dieta com alimentos integrais"],
      9: ["Acordar √†s 5h"],
      13: ["Medita√ß√£o (10 min por dia)"],
      17: ["Exerc√≠cio (60 min)"],
      21: ["Leitura (30 min)"],
      25: ["Alimenta√ß√£o sem a√ß√∫car refinado"],
      29: ["Pr√°tica de italiano (20 min por dia)"]
    };
    const habitos_ciclicos = [
      "Afirma√ß√µes",
      "Banho gelado",
      "Exerc√≠cio de agilidade mental",
      "Di√°rio e gratid√£o"
    ];

    const inicio = new Date(2025, 4, 21);
    const fim = new Date(2025, 7, 21);
    const dias_total = Math.floor((fim - inicio) / (1000 * 60 * 60 * 24)) + 1;

    let habitos_ativos = [];
    for (let i = 1; i <= dias_total; i++) {
      const data_atual = new Date(inicio);
      data_atual.setDate(inicio.getDate() + i - 1);

      if (habitos_incrementais[i]) {
        habitos_ativos = habitos_ativos.concat(habitos_incrementais[i]);
      }
      const habito_ciclico = habitos_ciclicos[(i - 1) % 4];

      dados.push({
        data: data_atual.toLocaleDateString('pt-BR'),
        dia: `Dia ${i}`,
        habitos: [...habitos_ativos],
        ciclico: habito_ciclico,
        mes: data_atual.getMonth() + 1,
        ano: data_atual.getFullYear(),
        id: `dia-${data_atual.getFullYear()}-${data_atual.getMonth()+1}-${data_atual.getDate()}`
      });
    }

    const calendario = document.getElementById("calendario");
    const grupos = {};

    dados.forEach((obj) => {
      const id = `${obj.mes}-${obj.ano}`;
      if (!grupos[id]) grupos[id] = [];
      grupos[id].push(obj);
    });

    let html = '';

    Object.entries(grupos).forEach(([id, dias]) => {
      const [mes, ano] = id.split("-");
      const nomeMes = new Date(`${ano}-${mes}-01`).toLocaleString('pt-BR', { month: 'long' });

      html += `
        <div class='mes'>${nomeMes.toUpperCase()} ${ano}</div>
        <table>
          <thead>
            <tr>
              <th></th>
              <th>Data</th>
              <th>Dia</th>
              <th>H√°bitos Di√°rios</th>
              <th>H√°bito C√≠clico</th>
            </tr>
          </thead>
          <tbody>
      `;

      dias.forEach((dia, i) => {
        html += `
        <tr class="main-row" data-dropdown="${dia.id}" id="mainrow-${dia.id}">
          <td><span class="expand-icon">&#9654;</span></td>
          <td>${dia.data}</td>
          <td>${dia.dia}</td>
          <td>${dia.habitos.join(', ')}</td>
          <td>${dia.ciclico}</td>
        </tr>
        <tr class="dropdown" id="dropdown-${dia.id}">
          <td colspan="5">
            <div class="habit-list">
              ${dia.habitos.map((h, idx) => `
                <div class="habit-item">
                  <span class="habit-emoji" tabindex="0">${habitEmojis[idx % habitEmojis.length]}</span>
                  <input type="checkbox" class="habit-checkbox" id="${dia.id}-habit-${idx}">
                  <label for="${dia.id}-habit-${idx}" id="label-${dia.id}-habit-${idx}">${h}</label>
                </div>
              `).join('')}
              <div class="habit-item">
                <span class="habit-emoji" tabindex="0">${cycleEmojis[(i)%cycleEmojis.length]}</span>
                <input type="checkbox" class="habit-checkbox" id="${dia.id}-ciclico">
                <label for="${dia.id}-ciclico" id="label-${dia.id}-ciclico">${dia.ciclico}</label>
              </div>
            </div>
          </td>
        </tr>
        `;
      });

      html += `
          </tbody>
        </table>
      `;
    });

    calendario.innerHTML = html;

    // ---- LOAD PROGRESS
    const progress = getProgress();
    Object.keys(progress).forEach(checkId => {
      const checkbox = document.getElementById(checkId);
      if (checkbox) {
        checkbox.checked = progress[checkId];
        const label = document.getElementById('label-' + checkId);
        if (label) label.classList.toggle('habit-done', progress[checkId]);
      }
    });

    // Dropdown toggle
    document.querySelectorAll('tr.main-row').forEach(row => {
      row.addEventListener('click', function() {
        const dropdownId = this.getAttribute('data-dropdown');
        const dropdown = document.getElementById(`dropdown-${dropdownId}`);
        if(dropdown.style.display === 'table-row') {
          dropdown.style.display = 'none';
          this.classList.remove('expanded');
        } else {
          dropdown.style.display = 'table-row';
          this.classList.add('expanded');
        }
      });
    });

    // Fun√ß√£o para verificar se todos os h√°bitos do dia foram conclu√≠dos
    function checkAllHabitsComplete(dayId, habitCount) {
      let complete = true;
      for(let i=0; i<habitCount; i++) {
        if (!document.getElementById(`${dayId}-habit-${i}`).checked) {
          complete = false;
          break;
        }
      }
      if (complete && !document.getElementById(`${dayId}-ciclico`).checked) complete = false;
      return complete;
    }

    // Play sound (com fallback de play for√ßado)
    function playCelebrateSound() {
      const audio = document.getElementById('celebrate-audio');
      audio.currentTime = 0;
      audio.volume = 0.93;
      // Workaround para autoplay block: for√ßa play, e tenta catch
      let played = false;
      audio.play().then(()=>{played=true;}).catch(()=>{
        // for√ßa play depois de qualquer clique futuro
        if (!played) {
          document.body.addEventListener('pointerdown', ()=>{
            audio.play();
          }, {once:true});
        }
      });
    }

    // Evento checkbox
    document.querySelectorAll('.habit-checkbox').forEach(checkbox => {
      checkbox.addEventListener('change', function() {
        const label = document.getElementById('label-' + this.id);
        if(this.checked) {
          label.classList.add('habit-done');
        } else {
          label.classList.remove('habit-done');
        }
        // Save progress
        let progress = getProgress();
        progress[this.id] = this.checked;
        saveProgress(progress);

        // Verifica se completou todos h√°bitos do dia
        const parts = this.id.match(/^dia-\d+-\d+-\d+/);
        if(parts) {
          const dayId = parts[0];
          const dayRow = document.getElementById(`mainrow-${dayId}`);
          const habitCount = document.querySelectorAll(`#dropdown-${dayId} .habit-checkbox`).length;
          const allDone = checkAllHabitsComplete(dayId, habitCount-1); // -1 pois o √∫ltimo √© o c√≠clico
          if(allDone) {
            dayRow.classList.add('day-complete');
            launchConfettiEpic();
            playCelebrateSound();
          } else {
            dayRow.classList.remove('day-complete');
          }
        }
      });
    });

    // Inicializa cor dos dias j√° completos ao carregar
    dados.forEach((dia) => {
      const habitCount = dia.habitos.length + 1; // +1 c√≠clico
      const allDone = checkAllHabitsComplete(dia.id, habitCount-1);
      if(allDone) {
        const dayRow = document.getElementById(`mainrow-${dia.id}`);
        if (dayRow) dayRow.classList.add('day-complete');
      }
    });

    // Redimensiona o canvas quando a tela mudar
    window.addEventListener('resize', function() {
      const canvas = document.getElementById('confetti-canvas');
      if(canvas.style.display === 'block') {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      }
    });

  });
</script>
</body>
</html>
